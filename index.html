<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Email Template</title>
  <link rel="stylesheet" href="style.css">
  <meta http-equiv="Content-Security-Policy"
        content="script-src 'self' https://www.gstatic.com https://apis.google.com https://accounts.google.com 'unsafe-inline' 'unsafe-eval';">
</head>

<body>
  <!-- ========== DARK MODE TOGGLE ========== -->
  <div class="dark-mode-toggle">
    <label class="switch">
      <input type="checkbox" id="toggleDarkMode">
      <span class="slider"></span>
    </label>
    <span id="toggleLabel">Dark Mode</span>
  </div>

  <!-- ========== EMAIL TEMPLATE OUTPUT ========== -->
  <div id="emailTemplate"></div>

  <!-- ========== HIDDEN ACTION BUTTONS ========== -->
  <button id="sendVendorEmailButton" style="display:none;"></button>
  <button id="sendManagementEmailButtonReal" style="display:none;"></button>
  <button id="sendSubcontractorEmailButton" style="display:none;"></button>

  <!-- ========== EMAIL OPTIONS PANEL ========== -->
  <section id="emailOptions" style="margin: 20px 0;">
    <label>
      <input type="checkbox" id="optionManagement" checked />
      Send Management Email
    </label>
    <br>
    <label>
      <input type="checkbox" id="optionSubcontractor" checked />
      Send Subcontractor Email(s)
    </label>
    <br>
    <label>
      <input type="checkbox" id="optionSendBlankSubEmail" />
      Send empty Subcontractor Email
    </label>
    <br>
    <div id="blankSubEmailMessage" style="display:none; color: lightgray; font-size: 14px; margin-top: 5px;">
      ‚ö†Ô∏è You will need to manually copy and paste subcontractor emails to avoid launching multiple batches of 30.
    </div>
    <div id="spanLoadingOverlay"
         style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.4); z-index:9999; justify-content:center; align-items:center; color:white; font-size:24px;">
      <div>‚è≥ Populating template...</div>
    </div>
    <label>
      <input type="checkbox" id="optionVendor" checked />
      Send Vendor Email
    </label>
    <br>
    <button id="sendSelectedEmails">Send Selected Emails</button>
  </section>

  <!-- ========== UTILITY CONTROLS ========== -->
  <button id="clearCacheBtn">Clear Cached Data</button>

  <!-- ========== DYNAMIC CONTENT ========== -->
  <div id="dynamicContainer"></div>

  <!-- ========== GOOGLE APIs (EXTERNAL) ========== -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js"></script>

  <!-- ========== APP SCRIPTS ========== -->
  <script src="script.js"></script>
  <!-- <script src="translate.js"></script> -->
  <script src="darkmode.js"></script>
  <script src="password.js"></script>

  <!-- ========== INLINE SCRIPTS (PREFERABLY EXTERNAL) ========== -->
  <script>
    // Checkbox dependency logic for blank subcontractor email
    const blankSubEmailCheckbox = document.getElementById("optionSendBlankSubEmail");
    const blankSubEmailMessage = document.getElementById("blankSubEmailMessage");
    const subCheckbox = document.getElementById("optionSubcontractor");

    if (blankSubEmailCheckbox && blankSubEmailMessage && subCheckbox) {
      blankSubEmailCheckbox.addEventListener("change", function () {
        if (this.checked) {
          blankSubEmailMessage.style.display = "block";
          console.log("‚òëÔ∏è 'Send empty Subcontractor Email' checkbox checked ‚Äî message shown.");

          if (subCheckbox.checked) {
            subCheckbox.checked = false;
            console.log("üîÅ 'Send Subcontractor Email' was unchecked due to empty subcontractor email setting.");
          }
        } else {
          blankSubEmailMessage.style.display = "none";
          console.log("‚¨ú 'Send empty Subcontractor Email' checkbox unchecked ‚Äî message hidden.");
        }
      });

      subCheckbox.addEventListener("change", function () {
        if (!this.checked) {
          blankSubEmailCheckbox.checked = true;
          blankSubEmailMessage.style.display = "block";
          console.log("üîÑ 'Send Subcontractor Email' unchecked ‚Äî 'Send empty Subcontractor Email' auto-checked.");
        }
      });

    } else {
      console.warn("‚ö†Ô∏è Required checkbox or message container not found.");
    }
  </script>
</body>

</html>
